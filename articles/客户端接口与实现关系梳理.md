# 前言
阅读Client相关代码时发现许多类名都很相近，难以理解。本篇针对客户端相关的接口与实现做了关系梳理，减少阅读代码的难度。

# 类关系梳理
![img](https://image.huawei.com/tiny-lts/v1/images/0f971f896e628b75c99b9960866c434e_2946x1392.png)

# 接口梳理

基础接口：
- MQAdmin：MQ管理者的基础接口。
- MQProducer：生产者的基础接口。
- Consumer：消费者的基础接口。

Consumer接口：
- MQPullConsumer：Pull模式下消费者相关接口。
- MQPushConsumer：Push模式下消费者相关接口。
- LitePullConsumer：Lite Pull模式下消费者相关接口。

Inner接口：
- MQProducerInner：生产者Inner接口。
- MQConsumerInner：消费者Inner接口。
- MQAdminExtInner：管理者Inner接口。


扩展接口：
- MQAdminExt：MQ管理者的扩展接口。

异步接口：
- MQClientAdmin：MQ管理相关的异步接口，但目前并没有实际使用。

# 实现类梳理

进程共享单例：
- MQClientInstance：客户端单例实例，每个客户端进程共享此实例。
- MQClientManager：用于创建并管理服务端创建的所有MQClientInstance实例。

底层API核心实现：
- MQClientAPIImpl：MQ客户端相关API的最终实现，作为MQClientInstance实例的字段创建及使用。
- MQClientAPIExt：MQClientAPIImpl的子类，提供更多Proxy集群模式下GRPC调用场景下使用的方法。
- MQClientAPIFactory：创建并管理MQClientAPIExt的工厂类。

管理者：
- MQAdminImpl：MQ管理者的默认实现，作为MQClientInstance实例的字段创建及使用。
- MqClientAdminImpl：MQClientAdmin的实现类，提供MQ管理相关的异步实现，目前并没有实际使用。

生产者：
- DefaultMQProducer：MQProducer的默认实现，实际内部调用DefaultMQProducerImpl。

消费者：
- DefaultMQPullConsumer：MQPullConsumer的默认实现，已废弃。
- DefaultMQPushConsumer：MQPushConsumer的默认实现。
- DefaultLitePullConsumerI：LitePullConsumer的默认实现。

生产核心实现：
- DefaultMQProducerImpl：MQProducerInner的默认实现，作为DefaultMQProducer的字段供调用，start后按生产组注册到MQClientInstance中供调用。

消费核心实现：
- DefaultMQPullConsumerImpl：MQConsumerInner的Pull模式的默认实现，作为DefaultMQPullConsumer的字段供调用，start后按消费组注册到MQClientInstance中供调用。
- DefaultMQPushConsumerImpl：MQConsumerInner的Push模式的默认实现，作为DefaultMQPushConsumer的字段供调用，start后按消费组注册到MQClientInstance中供调用。
- DefaultLitePullConsumerImpl：MQConsumerInner的Lite Pull模式的默认实现，作为DefaultLitePullConsumerI的字段供调用，start后按消费组注册到MQClientInstance中供调用。

工具命令行：
- DefaultMQAdminExt：MQAdminExt的默认实现，用于admin tools命令行场景，实际内部调用DefaultMQAdminExtImpl。
- DefaultMQAdminExtImpl：MQAdminExt的实现类，由DefaultMQAdminExt调用，实际内部调用MQClientAPIImpl以及MQAdminImpl。